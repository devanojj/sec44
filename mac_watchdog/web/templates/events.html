{% extends "base.html" %}
{% block title %}Events | Mac Security Watchdog{% endblock %}
{% block content %}
<section class="card">
  <h2>Event Timeline (Raw Evidence)</h2>
  <form method="get" class="filters">
    <label>Severity
      <select name="severity">
        <option value="" {% if not filters.severity %}selected{% endif %}>All</option>
        <option value="INFO" {% if filters.severity == "INFO" %}selected{% endif %}>INFO</option>
        <option value="WARN" {% if filters.severity == "WARN" %}selected{% endif %}>WARN</option>
        <option value="HIGH" {% if filters.severity == "HIGH" %}selected{% endif %}>HIGH</option>
      </select>
    </label>
    <label>Source
      <select name="source">
        <option value="" {% if not filters.source %}selected{% endif %}>All</option>
        <option value="process" {% if filters.source == "process" %}selected{% endif %}>process</option>
        <option value="login" {% if filters.source == "login" %}selected{% endif %}>login</option>
        <option value="network" {% if filters.source == "network" %}selected{% endif %}>network</option>
        <option value="filewatch" {% if filters.source == "filewatch" %}selected{% endif %}>filewatch</option>
        <option value="system" {% if filters.source == "system" %}selected{% endif %}>system</option>
      </select>
    </label>
    <label>Start (ISO)
      <input name="start" value="{{ filters.start }}" placeholder="2026-01-01T00:00:00+00:00" />
    </label>
    <label>End (ISO)
      <input name="end" value="{{ filters.end }}" placeholder="2026-01-01T23:59:59+00:00" />
    </label>
    <button type="submit">Filter</button>
  </form>

  <table>
    <thead>
      <tr><th>Time</th><th>Severity</th><th>Source</th><th>Title</th><th>Details</th></tr>
    </thead>
    <tbody>
      {% for event in events %}
      <tr>
        <td>{{ event.ts }}</td>
        <td><span class="badge {{ event.severity|lower }}">{{ event.severity }}</span></td>
        <td>{{ event.source }}</td>
        <td>{{ event.title }}</td>
        <td><code>{{ event.details }}</code></td>
      </tr>
      {% endfor %}
      {% if not events %}
      <tr>
        <td colspan="5">No matching events.</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <div class="pagination">
    {% if page > 1 %}
      <a href="?page={{ page - 1 }}&severity={{ filters.severity }}&source={{ filters.source }}&start={{ filters.start }}&end={{ filters.end }}">Previous</a>
    {% endif %}
    <span>Page {{ page }}</span>
    {% if events|length >= page_size %}
      <a href="?page={{ page + 1 }}&severity={{ filters.severity }}&source={{ filters.source }}&start={{ filters.start }}&end={{ filters.end }}">Next</a>
    {% endif %}
  </div>
</section>
{% endblock %}
